# AstrBot Plugin: QQ Emotion Reply (Tang Enhanced Edition)


> **致谢 / Credits**
>
> 本插件是基于 [QiChenSn/astrbot\_qqemotionreply](https://github.com/QiChenSn/astrbot_qqemotionreply) 进行的**深度魔改版本**。
> 在原版“贴表情”功能的基础上，增加了完整的“唐人系统（自动贴糖）”、“唐人排行榜”、“随机唐人”以及“唐人杀”等大量娱乐与互动功能。

## 📖 简介

这是一个用于 [AstrBot](https://github.com/Soulter/AstrBot) 的娱乐插件。

除了保留原版的**引用回复贴表情**（/fill）功能外，本插件引入了自动化的\*\*“贴糖”机制\*\*（针对特定用户自动回复 Emoji 147）。它支持通过指令管理“唐人名单”，统计被贴糖次数生成排行榜，甚至开启全群无差别攻击的“唐人杀”模式。

## ✨ 主要功能

1.  **基础贴表情**：引用消息并使用指令，让 Bot 回复一串随机表情。
2.  **自动贴糖**：
      * 将群友加入“唐人列表”，Bot 会在他发言时自动回复“🍬” (QQ表情棒棒糖[ID:147])。
      * 支持关键词触发：当消息中包含“糖”、“唐”、“🍬”、“tang”、“QQ表情棒棒糖[ID:147]”等字眼时自动触发。
3.  **唐人杀模式**：开启后，全群成员都被视为“唐人”，Bot 将根据设定的概率随机对所有发言贴糖。如果不开启，bot将按照随机概率从“唐人列表”中选择用户进行贴糖。
4.  **排行榜系统**：记录群友被贴糖的次数，并生成实时排名的“唐人排行榜”。
5.  **随机机制**：支持设置概率，让 Bot 不再由每句必贴，而是按百分比随机“降糖”。

## 🛠️ 安装与配置

### 1\. 安装

将本插件文件夹放入 AstrBot 的 `data/plugins/` 目录下，重启 AstrBot 即可。

### 2\. 配置文件 (`_conf_schema.json`)

插件支持通过 AstrBot 的 WebUI 进行配置，或直接修改配置文件。以下是主要配置项：

| 配置项 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `enable_tang` | bool | `true` | 是否启用自动贴糖总开关 |
| `default_emoji_num` | int | `5` | 手动贴表情时的默认数量 |
| `time_interval` | float | `0.5` | 贴表情时的发送间隔（秒） |
| `open_admin_mode` | bool | `false` | 管理员优待模式（防反击） |
| `random_tang` | object | - | 随机贴糖配置（开关及 0-100 的概率） |
| `tangWolfKill` | bool | `false` | 是否开启“唐人杀”全群攻击模式 |

## 💻 指令列表

### 基础指令 (所有用户可用)

| 指令 | 别名 | 说明 |
| :--- | :--- | :--- |
| `/贴表情 [数量]` | `/fill`, `/贴` | 引用一条消息，Bot 会回复指定数量的随机表情（上限20） |
| `/erhelp` | `/贴表情帮助` | 查看插件帮助说明 |
| `/seeTang` | `/查看唐人列表` | 查看当前被标记为“唐人”的 QQ 列表 |
| `/showTangRank` | `/唐人排行榜` | 查看被贴糖次数的排行榜 |

### 管理员指令 (Admin Only)

> **注意**：以下指令需要 AstrBot 管理员权限。

| 指令 | 别名 | 说明 |
| :--- | :--- | :--- |
| `/tang [QQ号]` | `/糖` | 将指定用户加入“唐人列表”（自动贴糖） |
| `/untang [QQ号]` | `/取消糖` | 将指定用户移出列表 |
| `/switchtang` | `/开关唐人` | 全局开启或关闭自动贴糖功能 |
| `/tangwolfkill` | `/唐人杀` | 开启/关闭全群无差别贴糖模式 |
| `/randomtang` | `/随机唐人` | 从群成员中随机抽取一位幸运儿加入列表 |
| `/switchrandomtang`| `/开关随机唐人`| 开启/关闭概率贴糖（而非每句必回） |
| `/setProbability` | `/设置随机唐人概率` | 设置随机贴糖的概率（0-100） |
| `/clearspecialqq` | `/清空唐人` | 清空当前所有名单 |


## 🗓️ TODO

### 🎨 功能增强
- [ ] **自定义“糖”**：目前固定为 QQ表情ID147，计划支持在配置中修改为其他表情。
- [ ] **唐人杀 2.0**：
    - [ ] 增加倒计时功能（例如：`唐人杀 10m`，10分钟后自动关闭）。
    - [ ] 增加“免疫卡”或“反弹卡”机制。
- [ ] **更智能的触发**：支持正则表达式触发，或接入 LLM 判断语气来决定是否贴糖（不仅仅是关键词）。

### 📊 体验优化
- [ ] **排行榜可视化**：目前排行榜为纯文本，计划接入绘图库，生成精美的“唐人战报”图片。
- [ ] **每日/每周重置**：增加排行榜的自动重置选项（日榜、周榜、总榜）。
- [ ] **成就系统**：当贴糖达到一定数量（如 100 次）获得特殊称号。

### 🛠️ 技术架构
- [ ] **数据库适配**：目前使用 JSON 存储数据，计划适配 SQLite/MySQL，以支持更大规模的数据存储和查询。
- [ ] **跨群数据隔离**：目前的“唐人列表”和“排行榜”是全局的，计划支持分群统计，每个群有独立的唐人和排名。
- [ ] **变量重写**：由于本人是第一次写astrbot插件，代码结构和变量命名可能不够规范，计划进行重构和优化。

---


## 📝 许可证

本项目遵循 **GNU General Public License v3.0 (GPLv3)**。

-----

**原作者仓库**: [https://github.com/QiChenSn/astrbot\_qqemotionreply](https://github.com/QiChenSn/astrbot_qqemotionreply)